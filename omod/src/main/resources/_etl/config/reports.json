{
  "report_definitions": [
    {
      "report_name": "PMTCT Mother HIV Status",
      "report_id": "mother_hiv_status",
      "report_sql": {
        "sql_query": "SELECT cn.name as hiv_test_result FROM mamba_source_db.obs o INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id INNER JOIN mamba_source_db.concept_name cn on o.value_coded = cn.concept_id WHERE p.uuid = person_uuid AND c.uuid = '159427AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND o.encounter_id = (SELECT e.encounter_id FROM mamba_source_db.obs o  INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.encounter_type et on e.encounter_type = et.encounter_type_id WHERE et.uuid = '2549af50-75c8-4aeb-87ca-4bb2cef6c69a' AND c.uuid = '159427AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND p.uuid = person_uuid ORDER BY encounter_datetime desc LIMIT 1) AND cn.voided = 0 AND cn.locale_preferred = 1 AND locale = 'en'",
        "query_params": [
          {
            "name": "person_uuid",
            "type": "VARCHAR(255)"
          }
        ]
      }
    },
    {
      "report_name": "PMTCT Total Deliveries",
      "report_id": "total_deliveries",
      "report_sql": {
        "sql_query": "SELECT COUNT(*) AS total_deliveries FROM mamba_source_db.encounter e INNER JOIN mamba_source_db.encounter_type et ON e.encounter_type = et.encounter_type_id WHERE et.uuid = '2678423c-0523-4d76-b0da-18177b439eed' AND e.encounter_datetime >= CONCAT(YEAR(CURDATE()), '-01-01 00:00:00')",
        "query_params": []
      }
    },
    {
      "report_name": "PMTCT HIV-Exposed Infants",
      "report_id": "hiv_exposed_infants",
      "report_sql": {
        "sql_query": "SELECT COUNT(DISTINCT ei.infant_client_id) AS total_hiv_exposed_infants FROM mamba_fact_pmtct_exposedinfants ei INNER JOIN mamba_dim_person p ON ei.infant_client_id = p.person_id WHERE ei.encounter_datetime BETWEEN DATE_FORMAT(NOW(), '%Y-01-01') AND NOW() AND birthdate BETWEEN DATE_FORMAT(NOW(), '%Y-01-01') AND NOW()",
        "query_params": []
      }
    },
    {
      "report_name": "PMTCT Total Pregnant women",
      "report_id": "total_pregnant_women",
      "report_sql": {
        "sql_query": "SELECT COUNT(DISTINCT pw.client_id) AS total_pregnant_women FROM mamba_fact_pmtct_pregnant_women pw WHERE visit_type like 'New%' AND encounter_datetime BETWEEN DATE_FORMAT(NOW(), '%Y-01-01') AND NOW() AND DATE_ADD(date_of_last_menstrual_period, INTERVAL 40 WEEK) > NOW()",
        "query_params": []
      }
    },
    {
      "report_name": "MNCH Mother Status",
      "report_id": "mother_status",
      "report_sql": {
        "sql_query": "SELECT cn.name as mother_status FROM mamba_source_db.obs o INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id INNER JOIN mamba_source_db.concept_name cn on o.value_coded = cn.concept_id WHERE p.uuid = person_uuid AND c.uuid = '1856AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND o.encounter_id = (SELECT e.encounter_id FROM mamba_source_db.obs o INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.encounter_type et on e.encounter_type = et.encounter_type_id WHERE et.uuid = '2678423c-0523-4d76-b0da-18177b439eed' AND c.uuid = '1856AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND p.uuid = person_uuid ORDER BY encounter_datetime desc  LIMIT 1) AND cn.voided = 0 AND cn.locale_preferred = 1 and locale ='en'",
        "query_params": [
          {
            "name": "person_uuid",
            "type": "VARCHAR(255)"
          }
        ]
      }
    },
    {
      "report_name": "MNCH Estimated Delivery Date",
      "report_id": "estimated_date_of_delivery",
      "report_sql": {
        "sql_query": "(SELECT CASE WHEN o.value_datetime >=curdate() THEN o.value_datetime ELSE '' END AS estimated_date_of_delivery FROM mamba_source_db.obs o INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id  WHERE p.uuid = person_uuid AND c.uuid = '5596AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND o.encounter_id = (SELECT e.encounter_id FROM mamba_source_db.obs o INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.encounter_type et on e.encounter_type = et.encounter_type_id WHERE et.uuid = '2549af50-75c8-4aeb-87ca-4bb2cef6c69a' AND c.uuid = '5596AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND p.uuid = person_uuid ORDER BY encounter_datetime desc  LIMIT 1) ORDER BY o.value_datetime DESC  LIMIT 1)",
        "query_params": [
          {
            "name": "person_uuid",
            "type": "VARCHAR(255)"
          }
        ]
      }
    },
    {
      "report_name": "MNCH Next Appointment",
      "report_id": "next_appointment_date",
      "report_sql": {
        "sql_query": "(SELECT o.value_datetime as next_appointment FROM mamba_source_db.obs o INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.encounter_type et on e.encounter_type = et.encounter_type_id LEFT JOIN (SELECT e.encounter_id FROM mamba_source_db.obs o INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.encounter_type et on e.encounter_type = et.encounter_type_id WHERE et.uuid = '2549af50-75c8-4aeb-87ca-4bb2cef6c69a' AND c.uuid = '5096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND p.uuid = person_uuid) a ON o.encounter_id = a.encounter_id LEFT JOIN (SELECT e.encounter_id FROM mamba_source_db.obs o INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id  INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.encounter_type et on e.encounter_type = et.encounter_type_id WHERE et.uuid = '269bcc7f-04f8-4ddc-883d-7a3a0d569aad' AND c.uuid = '5096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND p.uuid = person_uuid)b  on o.encounter_id = b.encounter_id WHERE et.uuid = '2549af50-75c8-4aeb-87ca-4bb2cef6c69a' AND c.uuid = '5096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND p.uuid = person_uuid ORDER BY  encounter_datetime DESC LIMIT 1)",
        "query_params": [
          {
            "name": "person_uuid",
            "type": "VARCHAR(255)"
          }
        ]
      }
    },
    {
      "report_name": "MNCH Number of ANC Visits",
      "report_id": "no_of_anc_visits",
      "report_sql": {
        "sql_query": "SELECT COUNT(DISTINCT e.encounter_id)no_of_anc_visits FROM mamba_source_db.obs o INNER JOIN mamba_source_db.concept c on o.concept_id = c.concept_id INNER JOIN mamba_source_db.person p on o.person_id = p.person_id INNER JOIN mamba_source_db.encounter e on o.encounter_id = e.encounter_id INNER JOIN mamba_source_db.encounter_type et on e.encounter_type = et.encounter_type_id WHERE et.uuid = '2549af50-75c8-4aeb-87ca-4bb2cef6c69a' AND c.uuid = '5596AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' AND o.value_datetime >= curdate() AND p.uuid = person_uuid",
        "query_params": [
          {
            "name": "person_uuid",
            "type": "VARCHAR(255)"
          }
        ]
      }
    }
  ]
}